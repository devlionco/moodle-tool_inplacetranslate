define("tool_inplacetranslate/main",["exports","core/ajax","core/notification","core/templates","core/utils","core/modal_factory","core/modal_events","core/str"],(function(_exports,_ajax,_notification,_templates,_utils,_modal_factory,_modal_events,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript main event handler.
   *
   * @module     tool/inplacetranslate
   * @copyright  2024 Devlionco <info@devlion.co>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      4.1
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);let oldTranslate;const Selectors={targets:{menu:"inplacetranslate_menu",menuToggler:"inplacetranslate_menu_toggler",search:"inplacetranslate_search",clearSearchBtn:"inplacetranslate_clear_search_btn",items:"inplacetranslate-item",translatesForm:"translates_form"},elements:{}};_exports.init=()=>{Selectors.elements.menu=document.getElementById(Selectors.targets.menu),Selectors.elements.menuToggler=document.getElementById(Selectors.targets.menuToggler),Selectors.elements.search=document.getElementById(Selectors.targets.search),Selectors.elements.clearSearchBtn=document.getElementById(Selectors.targets.clearSearchBtn),Selectors.elements.items=document.querySelectorAll("."+Selectors.targets.items),document.onclick=event=>{if(event.target.closest(".inplacetranslate-item")){const identifier=event.target.closest(".inplacetranslate-item").dataset.id.toString();oldTranslate=event.target.closest(".inplacetranslate-item").dataset.translate,(query=identifier,(0,_ajax.call)([{methodname:"tool_inplacetranslate_get_translated_string",args:{query:query}}])[0]).then((result=>showModal(result))).catch((error=>(0,_notification.exception)(error)))}var query},Selectors.elements.clearSearchBtn.onclick=()=>{Selectors.elements.search.value="",Selectors.elements.items.forEach((element=>{element.closest("li").classList.add("d-flex"),element.closest("li").classList.remove("d-none")})),Selectors.elements.clearSearchBtn.classList.add("d-none")},Selectors.elements.menuToggler.onclick=()=>{Selectors.elements.menuToggler.classList.contains("shown")?(Selectors.elements.menuToggler.classList.remove("shown"),document.body.classList.add("inplacetranslate-menu-shown")):(Selectors.elements.menuToggler.classList.add("shown"),document.body.classList.remove("inplacetranslate-menu-shown"))},Selectors.elements.search.addEventListener("keyup",(0,_utils.debounce)((event=>{event.preventDefault();(searchQuery=>{const htmlRegex=/(<([^>]+)>)/gi;Selectors.elements.items.forEach((element=>{const text=element.innerHTML.replace(htmlRegex," ").trim().toLowerCase(),dataset=element.dataset.translate.replace(htmlRegex," ").trim().toLowerCase();text.includes(searchQuery)||dataset.includes(searchQuery)?(element.closest("li").classList.add("d-flex"),element.closest("li").classList.remove("d-none")):(element.closest("li").classList.remove("d-flex"),element.closest("li").classList.add("d-none"))}))})(event.target.value.toString().toLowerCase().trim()),Selectors.elements.clearSearchBtn.classList.remove("d-none")}),500))};const saveTranslate=form=>{const identifier=form.dataset.id,data=[];form.querySelectorAll("textarea").forEach((el=>{data.push({string:el.value.trim(),lang:el.dataset.lang.toLowerCase()})})),((identifier,translateJson)=>(0,_ajax.call)([{methodname:"tool_inplacetranslate_set_translated_string",args:{identifier:identifier,translateJson:translateJson}}])[0])(identifier,JSON.stringify(data)).then((()=>{(0,_str.get_string)("stringwasupdated","tool_inplacetranslate",oldTranslate).then((str=>{const alertElement=document.createElement("div");alertElement.classList.add("position-fixed","alert","alert-success","alert-dismissible","p-3","fade","show"),alertElement.setAttribute("role","alert"),alertElement.setAttribute("style","top: 15vh; left: 32vw;position: fixed; z-index: 100;");const closeButton=document.createElement("button");closeButton.classList.add("close"),closeButton.setAttribute("type","button"),closeButton.setAttribute("data-dismiss","alert");const closeSpan=document.createElement("span");return closeSpan.setAttribute("aria-hidden","true"),closeSpan.textContent="Ã—",closeButton.appendChild(closeSpan),alertElement.appendChild(document.createTextNode(str)),alertElement.appendChild(closeButton),document.body.appendChild(alertElement)})).catch((error=>(0,_notification.exception)(error)))})).catch((error=>(0,_notification.exception)(error)))},showModal=async data=>{const templateContext=JSON.parse(data),modal=await _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,large:!0,title:(0,_str.get_string)("setnewtranslate","tool_inplacetranslate"),body:_templates.default.render("tool_inplacetranslate/stringmodal",templateContext)});modal.show(),modal.getRoot().on(_modal_events.default.save,(()=>{const form=modal.getBody()[0].querySelector("#"+Selectors.targets.translatesForm);saveTranslate(form),modal.destroy()}))}}));

//# sourceMappingURL=main.min.js.map